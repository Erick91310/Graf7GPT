
import tkinter as tk
from PIL import Image, ImageTk

# Création de la fenêtre principale
root = tk.Tk()
root.title("Editeur de Grafcet")
root.geometry("800x800")

# Création de la grille de sélection
selection_grid = tk.Frame(root, bg="white", highlightthickness=2, highlightbackground="black")
selection_grid.grid(row=0, column=0, padx=10, pady=10)

# Création de la grille de travail
work_grid = tk.Canvas(root, bg="light grey", width=640, height=640, highlightthickness=1)
work_grid.grid(row=0, column=1, padx=10, pady=10)

# Variables pour les icônes
icon_etape = tk.PhotoImage(file="icons/icon_etape.png")
icon_transition = tk.PhotoImage(file="icons/icon_transition.png")

# Variables pour la sélection
selected_icon = None
last_selected = None

# Fonction pour changer l'icône sélectionné
def select_icon(icon):
    global selected_icon
    selected_icon = icon

# Fonction pour placer l'icône sélectionné sur la grille de travail
def place_icon(event):
    global last_selected
    if selected_icon:
        x = event.x // 16 * 16 + 8
        y = event.y // 16 * 16 + 8
        if last_selected != (x,y):
            last_selected = (x,y)
            work_grid.create_image(x, y, image=selected_icon)

# Fonction pour lier la touche "e" à l'icône étape et "t" à l'icône transition
def key_press(event):
    global selected_icon
    if event.char == "e":
        select_icon(icon_etape)
    elif event.char == "t":
        select_icon(icon_transition)

# Lier les fonctions aux événements
selection_grid.bind("<Button-1>", lambda e: select_icon(icon_etape))
selection_grid.bind("<Button-2>", lambda e: select_icon(icon_transition))
work_grid.bind("<Button-1>", place_icon)
root.bind("<Key>", key_press)


# Chargement des images
icon_etape = ImageTk.PhotoImage(Image.open("icons/icon_etape.png"))
icon_transition = ImageTk.PhotoImage(Image.open("icons/icon_transition.png"))
icon_liaison = ImageTk.PhotoImage(Image.open("icons/icon_liaison.png"))
icon_liaison_bas_gauche = ImageTk.PhotoImage(Image.open("icons/icon_liaison_bas_gauche.png"))
icon_liaison_bas_droite = ImageTk.PhotoImage(Image.open("icons/icon_liaison_bas_droite.png"))
icon_liaison_haut_droite = ImageTk.PhotoImage(Image.open("icons/icon_liaison_haut_droite.png"))
icon_liaison_haut_gauche = ImageTk.PhotoImage(Image.open("icons/icon_liaison_haut_gauche.png"))


for row in range(2):
    for col in range(3):
        frame = tk.Frame(selection_grid, width=32, height=32, bg="blue", highlightthickness=2, highlightbackground="blue")
        frame.grid(row=row, column=col, padx=2, pady=2)

        if col == 0:
            tk.Label(frame, image=icon_etape).pack()
        elif col == 1 and row == 0:
            tk.Label(frame, image=icon_transition).pack()
        elif col == 2 and row == 0:
            tk.Label(frame, image=icon_liaison).pack()
        elif col == 1 and row == 1:
            tk.Label(frame, image=icon_liaison_bas_gauche).pack()
        elif col == 0 and row == 1:
            tk.Label(frame, image=icon_liaison_haut_gauche).pack()
        elif col == 2 and row == 1:
            tk.Label(frame, image=icon_liaison_bas_droite).pack()
        elif col == 1 and row == 0:
            tk.Label(frame, image=icon_liaison_haut_droite).pack()